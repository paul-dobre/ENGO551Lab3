<!DOCTYPE html>
<html>

    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
        <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.css" />
        <link rel="stylesheet" href="Leaflet.markercluster-1.4.1\dist\MarkerCluster.Default.css"/>

        <!--Leaflet marker cluster taken from here: https://github.com/Leaflet/Leaflet.markercluster/tree/leaflet-0.7-->
        <script src="Leaflet.markercluster-1.4.1\dist\leaflet.markercluster-src.js"></script>
        <script src="Leaflet.markercluster-1.4.1\src\MarkerCluster.js"></script>

    </head>

    <body>
        <div id="map"></div>
    </body>

</html>



<script>

    var map = L.map('map').setView([51.0347, -114.0719], 11);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
    var markers = L.markerClusterGroup();
    function loadMap(startDate, endDate) {
        console.log('https://data.calgary.ca/resource/c2es-76ed.geojson?$where=issueddate > '+startDate+' and issueddate < '+endDate+'')
        fetch(`https://data.calgary.ca/resource/c2es-76ed.geojson?$where=issueddate > '${startDate}' and issueddate < '${endDate}'`)
        .then(response => {
            if (!response.ok) {
            throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {

            markers.clearLayers();
            L.geoJSON(data, {
                onEachFeature: function (feature, layer) {
                    var popupContent = '<b> Build Permit Info: </b>';
                    popupContent += '<br>'+ 'Issued Date: ' + feature.properties.issueddate + '<br>';
                    popupContent += '<br>'+ 'Work Class Group: ' +feature.properties.workclassgroup + '<br>';
                    popupContent += '<br>'+ ' Contractor: ' + feature.properties.contractorname + '<br>';
                    popupContent += '<br>'+ 'Community: ' + feature.properties.communityname + '<br>';
                    popupContent += '<br>'+ 'Original Address: ' + feature.properties.originaladdress+ '<br>';
                    layer.bindPopup(popupContent);
                }
            }).addTo(markers);

            map.addLayer(markers);



            console.log(data);
            console.log(data.features[0].properties.communityname)
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
    }

    loadMap('2000-01-01', '2001-01-01');
    
</script>

<!--Date range picker taken from here: https://www.daterangepicker.com/-->
<input class="date" type="text" name="daterange" value="01/01/2000 - 01/15/2001" />

<script>

$(function() {
  $('input[name="daterange"]').daterangepicker({
    opens: 'center'
  }, function(start, end, label) {
    loadMap(start.format('YYYY-MM-DD'), end.format('YYYY-MM-DD'));
    console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
  });
  
  
});
</script>